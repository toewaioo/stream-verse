# Telegram Mini App Setup Guide

This guide explains how to configure your Telegram bot to work with the auto-login feature.

## Prerequisites

- A Telegram Bot created via [@BotFather](https://t.me/botfather)
- Bot token configured in `.env` file
- Application deployed and accessible via HTTPS

## Configuration Steps

### 1. Environment Variables

Add the following to your `.env` file:

```env
TELEGRAM_BOT_TOKEN=your_bot_token_here
TELEGRAM_BOT_USERNAME=your_bot_username
```

### 2. Set Up Web App URL in BotFather

1. Open Telegram and search for [@BotFather](https://t.me/botfather)
2. Send `/mybots` command
3. Select your bot
4. Click on "Bot Settings"
5. Click on "Menu Button"
6. Choose "Edit Menu Button URL"
7. Enter your TgAuth page URL:
   ```
   https://yourdomain.com/tgauth
   ```

### 3. How It Works

When a user opens your bot and clicks the menu button (or any button that opens your Web App):

1. **Entry Point**: User is directed to `/tgauth` page
2. **Detection**: Page detects Telegram Mini App environment
3. **Authentication**: Automatically sends Telegram's `initData` to the backend
4. **Verification**: Backend validates the data and creates/logs in the user
5. **Redirect**: User is automatically redirected to the home page

### 4. Development & Debugging

The TgAuth page includes comprehensive logging for development:

- Shows all authentication steps in real-time
- Displays Telegram WebApp data
- Shows API responses and errors
- Color-coded log levels (info, success, warning, error)

### 5. Testing

To test the integration:

1. Open your bot in Telegram
2. Click the menu button or any Web App link
3. Check the developer logs on the TgAuth page
4. Verify automatic redirect to home page after login

### 6. Production Deployment

For production:

- Ensure HTTPS is properly configured
- Set the correct domain in BotFather
- Monitor authentication logs for any issues
- Consider removing or hiding detailed logs in production

## Backend API Endpoint

The authentication uses this endpoint:

```
POST /auth/telegram/mini-app
```

Request payload:
```json
{
  "initData": "telegram_init_data_string"
}
```

The backend validates this data using the Telegram Bot API and authenticates the user.

## Troubleshooting

### Issue: "Not running in Telegram WebApp"
- Make sure you're accessing the app through Telegram's Web App interface
- Verify the URL is set correctly in BotFather

### Issue: "No initData available"
- Check that Telegram's script is loaded (`telegram-web-app.js`)
- Verify your app is accessed via HTTPS

### Issue: "Login failed"
- Check backend logs for validation errors
- Verify `TELEGRAM_BOT_TOKEN` is correct in `.env`
- Ensure the backend endpoint is accessible

## Security Notes

- The `initData` is validated server-side using Telegram's authentication method
- Never trust client-side data without server validation
- The authentication token is securely generated by Telegram
- User data is automatically created/updated based on Telegram profile

## Additional Resources

- [Telegram Web Apps Documentation](https://core.telegram.org/bots/webapps)
- [Telegram Bot API](https://core.telegram.org/bots/api)
