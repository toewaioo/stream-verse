import{b as R,r as h,j as e,c as _}from"./app-BYbdxqmm.js";import{u as E}from"./useFormPersistence-oh6I_xkV.js";import{I as i}from"./InputLabel-D74bIlPX.js";import{T as n,I as c}from"./InputError-BOTsRLCn.js";import{P as v}from"./PrimaryButton-ByBAnikI.js";import{S as N}from"./SecondaryButton-BF5wLR4c.js";import{M as I}from"./Modal-BYAFEK_S.js";import"./portal-D6B0HNnL.js";import"./transition-CDfkvudE.js";function W({person:r,onClose:u,onSuccess:g}){const{data:o,setData:s,post:w,put:k,processing:f,errors:l}=R({name:r?.name||"",biography:r?.biography||"",birth_date:r?.birth_date||"",death_date:r?.death_date||"",place_of_birth:r?.place_of_birth||"",avatar_url:r?.avatar_url||""}),S=r?.id?`person_form_update_${r.id}`:"person_form_create",{clearStorage:y}=E(S,o,s),[T,p]=h.useState(!1),[x,D]=h.useState(""),[j,C]=h.useState([]),[b,m]=h.useState(!1),F=async a=>{if(a.preventDefault(),!!x){m(!0);try{const t=await _.post(route("admin.tmdb.search"),{query:x,type:"person"});C(t.data.results||[])}catch(t){console.error("TMDB Search Error:",t)}finally{m(!1)}}},B=async a=>{m(!0);try{const d=(await _.post(route("admin.tmdb.details"),{tmdb_id:a,type:"person"})).data;s(P=>({...P,name:d.name,biography:d.biography,birth_date:d.birth_date||"",death_date:d.death_date||"",place_of_birth:d.place_of_birth||"",avatar_url:d.avatar_url||""})),p(!1)}catch(t){console.error("TMDB Details Error:",t)}finally{m(!1)}},M=a=>{a.preventDefault(),r?k(route("admin.persons.update",r.id),{onSuccess:()=>{y(),g(),u()}}):w(route("admin.persons.store"),{onSuccess:()=>{y(),g(),u()}})};return e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(i,{htmlFor:"name",value:"Name"}),e.jsx(N,{size:"sm",onClick:()=>p(!0),type:"button",children:"Fetch from TMDB"})]}),e.jsx(n,{id:"name",type:"text",className:"mt-1 block w-full",value:o.name,onChange:a=>s("name",a.target.value),required:!0}),e.jsx(c,{message:l.name,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"biography",value:"Biography"}),e.jsx("textarea",{id:"biography",className:"mt-1 block w-full border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 focus:border-indigo-500 focus:ring-indigo-500 rounded-md shadow-sm",rows:"4",value:o.biography,onChange:a=>s("biography",a.target.value)}),e.jsx(c,{message:l.biography,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"avatar_url",value:"Avatar URL"}),e.jsx(n,{id:"avatar_url",type:"url",className:"mt-1 block w-full",value:o.avatar_url,onChange:a=>s("avatar_url",a.target.value)}),e.jsx(c,{message:l.avatar_url,className:"mt-2"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"place_of_birth",value:"Place of Birth"}),e.jsx(n,{id:"place_of_birth",type:"text",className:"mt-1 block w-full",value:o.place_of_birth,onChange:a=>s("place_of_birth",a.target.value)}),e.jsx(c,{message:l.place_of_birth,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"birth_date",value:"Birth Date"}),e.jsx(n,{id:"birth_date",type:"date",className:"mt-1 block w-full",value:o.birth_date,onChange:a=>s("birth_date",a.target.value)}),e.jsx(c,{message:l.birth_date,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"death_date",value:"Death Date"}),e.jsx(n,{id:"death_date",type:"date",className:"mt-1 block w-full",value:o.death_date,onChange:a=>s("death_date",a.target.value)}),e.jsx(c,{message:l.death_date,className:"mt-2"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 border-t pt-4",children:[e.jsx(N,{onClick:u,disabled:f,type:"button",children:"Cancel"}),e.jsx(v,{disabled:f,type:"submit",children:r?"Update Person":"Create Person"})]})]}),e.jsx(I,{show:T,onClose:()=>p(!1),maxWidth:"2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-4",children:"Search TMDB for People"}),e.jsxs("form",{onSubmit:F,className:"flex gap-2 mb-4",children:[e.jsx(n,{type:"text",className:"w-full",placeholder:"Search for an actor, director, or crew member...",value:x,onChange:a=>D(a.target.value)}),e.jsx(v,{type:"submit",disabled:b,children:b?"Searching...":"Search"})]}),e.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[j.map(a=>e.jsxs("button",{type:"button",className:"w-full flex items-center gap-4 p-3 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer border border-gray-200 dark:border-gray-600 transition-colors text-left",onClick:t=>{t.preventDefault(),t.stopPropagation(),B(a.id)},children:[a.profile_path?e.jsx("img",{src:`https://image.tmdb.org/t/p/w92${a.profile_path}`,alt:a.name,className:"w-16 h-16 object-cover rounded-full"}):e.jsx("div",{className:"w-16 h-16 bg-gray-200 dark:bg-gray-600 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:a.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a.known_for_department||"Actor"}),a.known_for&&a.known_for.length>0&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:["Known for: ",a.known_for.slice(0,2).map(t=>t.title||t.name).join(", ")]})]})]},a.id)),j.length===0&&!b&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No results found. Try searching for an actor or director."})]})]})})]})}export{W as default};
