import{r as c,a as o,b as l,j as s}from"./app-B6avVaRr.js";import{L as p}from"./Loader-BQXAIg6J.js";function A({user:n}){const r=c.useRef(!1),[f,u]=c.useState([]),[m,a]=c.useState("Initializing..."),e=(t,i="info")=>{const g=new Date().toLocaleTimeString();u(d=>[...d,{timestamp:g,message:t,type:i}]),console.log(`[${g}] ${t}`)};return c.useEffect(()=>{if(e("TgAuth page mounted","info"),e(`User authenticated: ${!!n}`,"info"),window.Telegram?.WebApp){const t=window.Telegram.WebApp;if(e("Telegram WebApp detected","success"),e(`initData present: ${!!t.initData}`,"info"),t.initData&&e(`initData: ${t.initData.substring(0,50)}...`,"info"),t.ready(),e("Telegram WebApp ready","success"),n){e("User already authenticated, redirecting to home...","success"),a("Already logged in! Redirecting..."),setTimeout(()=>{o.visit(route("home"))},1500);return}!n&&t.initData&&!r.current?(r.current=!0,a("Authenticating with Telegram..."),e("Attempting to login via Mini App...","info"),l.post(route("auth.telegram.mini-app"),{initData:t.initData}).then(i=>{e("Login successful!","success"),e(`Response: ${JSON.stringify(i.data)}`,"info"),a("Redirecting to home..."),setTimeout(()=>{o.visit(route("home"))},1e3)}).catch(i=>{e("Login failed!","error"),a("Authentication failed"),i.response?(e(`Error status: ${i.response.status}`,"error"),e(`Error data: ${JSON.stringify(i.response.data)}`,"error")):i.request?e("No response received from server","error"):e(`Error: ${i.message}`,"error"),r.current=!1})):t.initData?r.current&&(e("Login already attempted","info"),a("Authenticate success"),setTimeout(()=>{e("Redirecting to home page...","info"),o.visit(route("home"))},1e3)):(e("No initData available - cannot authenticate","warning"),a("Loading ..."),setTimeout(()=>{e("Redirecting to home page...","info"),o.visit(route("home"))},1e3))}else e("Not running in Telegram WebApp environment","warning"),a("Loading ...."),setTimeout(()=>{e("Redirecting to home page...","info"),o.visit(route("home"))},1e3)},[n]),s.jsxs(s.Fragment,{children:[s.jsx(p,{title:"Authentication",status:m}),n&&s.jsxs("div",{className:"text-center text-sm text-green-400",children:["âœ“ Logged in as: ",n.name||n.email]}),s.jsx("div",{className:"mt-6 text-center",children:s.jsx("button",{onClick:()=>o.visit(route("home")),className:"px-6 py-3 bg-white text-black font-bold uppercase tracking-widest hover:bg-gray-200 transition-colors rounded",children:"Go to Home"})})]})}export{A as default};
